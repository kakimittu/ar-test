<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>CYBER AR - akazawa Edition</title>
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAHJPzHf4QR3V4GOcd0l3s-_VvSSYeWZAA", // ここを書き換えてください
  authDomain: "armisetai.firebaseapp.com",
  projectId: "armisetai",
  storageBucket: "armisetai.firebasestorage.app",
  messagingSenderId: "1006973944547",
  appId: "1:1006973944547:web:adc5e195039585bbdabbd6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addEventListener("DOMContentLoaded", async () => {
  const markerId = "akazawa"; 
  const docRef = doc(db, "arUsers", markerId); // コレクション名維持
  const docSnap = await getDoc(docRef);

  if (docSnap.exists()) {
    const data = docSnap.data();
    const images = data.images;
    const marker = document.querySelector("a-marker");

    let currentIndex = 0;
    const planes = [];

    // ===== 画像生成 =====
    images.forEach((url) => {
    images.forEach((url) => {
      const plane = document.createElement("a-plane");
      plane.setAttribute("rotation", "-90 0 0");
      plane.setAttribute("visible", "false");
      plane.setAttribute("material", "shader: flat; transparent: true; side: double; alphaTest: 0.5;");
      plane.setAttribute("src", url);

      // 画像比率の自動調整
      const img = new Image();
      img.onload = function() {
        const aspect = img.height / img.width;
        const baseWidth = 1.6;
        plane.setAttribute("width", baseWidth);
        plane.setAttribute("height", baseWidth * aspect);
      };
      img.src = url;

      marker.appendChild(plane);
      planes.push(plane);
    });

    // ===== 表示更新関数 =====
    function updateCarousel() {
      planes.forEach((plane, index) => {
        plane.setAttribute("visible", "false");

        if (index === currentIndex) {
          plane.setAttribute("position", "0 0.15 0");
          plane.setAttribute("scale", "1.3 1.3 1.3");
          plane.setAttribute("visible", "true");
        } else if (index === (currentIndex - 1 + planes.length) % planes.length) {
          plane.setAttribute("position", "-1.8 0.12 -0.2"); // 少し間隔を調整
          plane.setAttribute("scale", "0.7 0.7 0.7");
          plane.setAttribute("visible", "true");
        } else if (index === (currentIndex + 1) % planes.length) {
          plane.setAttribute("position", "1.8 0.12 -0.2");
          plane.setAttribute("scale", "0.7 0.7 0.7");
          plane.setAttribute("visible", "true");
        }
      });
    }

    // 初回表示を実行
    setTimeout(updateCarousel, 500);

    // ===== タップ切替 =====
    marker.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % planes.length;
      updateCarousel();
    });

    // ===== スワイプ切替 =====
    let startX = 0;
    window.addEventListener("touchstart", (e) => { startX = e.touches[0].clientX; });
    window.addEventListener("touchend", (e) => {
      let endX = e.changedTouches[0].clientX;
      let diff = endX - startX;
      if (Math.abs(diff) > 50) {
        currentIndex = (diff > 0) ? (currentIndex - 1 + planes.length) % planes.length : (currentIndex + 1) % planes.length;
        updateCarousel();
      }
    });
  }
});
</script>

<style>
  body { margin: 0; overflow: hidden; }
</style>
</head>
<body>
<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
  <a-marker type="pattern" url="assets/markers/pattern-AKA2.patt">
    
    <a-plane color="#ff9900" width="2" height="1.2" position="0 0.01 0" rotation="-90 0 0"
      material="shader: flat; opacity: 0.3; transparent: true; blending: additive; depthWrite: false"
      animation="property: material.opacity; from: 0.1; to: 0.4; dir: alternate; dur: 2000; loop: true">
    </a-plane>

    <a-circle radius="0.08" color="#ff8c00" position="-1.2 0.1 0.5" rotation="-90 0 0"
      material="shader: flat; transparent: true; opacity: 0.6; blending: additive"
      animation="property: scale; from: 1 1 1; to: 1.3 1.3 1; dir: alternate; dur: 800; loop: true">
    </a-circle>
    
    <a-circle radius="0.08" color="#ff4500" position="1.2 0.1 0.5" rotation="-90 0 0"
      material="shader: flat; transparent: true; opacity: 0.6; blending: additive"
      animation="property: scale; from: 1 1 1; to: 1.3 1.3 1; dir: alternate; dur: 1000; loop: true">
    </a-circle>

  </a-marker>
  <a-entity camera></a-entity>
</a-scene>
</body>
</html>





