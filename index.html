<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>AR Image Switch</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
}

#nextBtn2D {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 15px 20px;
  font-size: 16px;
  background: blue;
  color: white;
  border: none;
  border-radius: 10px;
  z-index: 9999;
}

#prevBtn2D {
  position: fixed;
  bottom: 20px;
  left: 20px;
  padding: 15px 20px;
  font-size: 16px;
  background: gray;
  color: white;
  border: none;
  border-radius: 10px;
  z-index: 9999;
}
</style>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false"
>

  <a-assets id="assets"></a-assets>

  <a-marker
    id="marker"
    type="pattern"
    url="assets/markers/pattern-AKA2.patt"
  ></a-marker>

  <a-entity camera></a-entity>

</a-scene>

<button id="prevBtn2D">◀ 前へ</button>
<button id="nextBtn2D">次へ ▶</button>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAHJPzHf4QR3V4GOcd0l3s-_VvSSYeWZAA",
    authDomain: "armisetai.firebaseapp.com",
    projectId: "armisetai",
    storageBucket: "armisetai.firebasestorage.app",
    messagingSenderId: "1006973944547",
    appId: "1:1006973944547:web:adc5e195039585bbdabbd6"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
　const db = getFirestore(app);

let currentIndex = 1;
let isMarkerVisible = false;

const marker = document.getElementById("marker");
const assets = document.getElementById("assets");

async function loadData() {
  const docSnap = await getDoc(doc(db, "arData", "main"));

  if (!docSnap.exists()) return;

  const data = docSnap.data();
  const images = data.images;
  currentIndex = data.centerIndex;

  const imageElements = [];

  images.forEach((src, index) => {
    const assetImg = document.createElement("img");
    assetImg.setAttribute("id", "img-src-" + index);
    assetImg.setAttribute("src", src);
    assets.appendChild(assetImg);

    const aImg = document.createElement("a-image");
    aImg.setAttribute("src", "#img-src-" + index);
    aImg.setAttribute("rotation", "-90 0 0");
    marker.appendChild(aImg);

    imageElements.push(aImg);
  });

  function updateImages() {
    imageElements.forEach((el, index) => {
      if (index === currentIndex) {
        el.setAttribute("position", "0 0 0");
        el.setAttribute("scale", "1.2 1.2 1.2");
      } else if (index < currentIndex) {
        el.setAttribute("position", "-1 0 0");
        el.setAttribute("scale", "0.6 0.6 0.6");
      } else {
        el.setAttribute("position", "1 0 0");
        el.setAttribute("scale", "0.6 0.6 0.6");
      }
    });
  }

  marker.addEventListener("markerFound", () => {
    isMarkerVisible = true;
  });

  marker.addEventListener("markerLost", () => {
    isMarkerVisible = false;
  });

  document.getElementById("nextBtn2D").onclick = () => {
    if (!isMarkerVisible) return;
    currentIndex = (currentIndex + 1) % imageElements.length;
    updateImages();
  };

  document.getElementById("prevBtn2D").onclick = () => {
    if (!isMarkerVisible) return;
    currentIndex =
      (currentIndex - 1 + imageElements.length) %
      imageElements.length;
    updateImages();
  };

  updateImages();
}

loadData();

</script>



</body>
</html>


