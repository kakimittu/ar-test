<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>印刷物AR 完成版</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
    }

    /* 切り替えボタン */
    #ui {
      position: fixed;
      top: 10px;
      left: 0;
      right: 0;
      text-align: center;
      z-index: 999;
    }

    #ui button {
      font-size: 16px;
      padding: 8px 16px;
      margin: 0 6px;
    }

    /* デバッグUI */
    #debugUI {
      position: fixed;
      bottom: 10px;
      left: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px;
      border-radius: 10px;
      font-size: 12px;
      z-index: 999;
    }

    #debugUI label {
      display: block;
      margin-top: 6px;
    }

    #debugUI input {
      width: 100%;
    }
  </style>
</head>

<body>

<!-- ===== 切り替えUI ===== -->
<div id="ui">
  <button onclick="showImage()">画像</button>
  <button onclick="showModel()">3D</button>
</div>

<!-- ===== ARシーン ===== -->
<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
  
  <a-marker type="pattern" url="assets/markers/pattern-ROBOTA.patt">

    <!-- 画像 -->
    <a-image
      id="image"
      src="assets/images/3.png"
      width="1"
      height="1"
      rotation="-90 0 0"
      position="0 0 0.01"
      visible="true">
    </a-image>

    <!-- 3Dモデル -->
    <a-entity
      id="model"
      gltf-model="assets/models/Pumpkin.glb"
      position="0 -0.6 0"
      rotation="-95 180 0"
      scale="0.15 0.15 0.15"
      visible="false">
    </a-entity>

  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<!-- ===== デバッグUI ===== -->
<div id="debugUI">
  <label>X（左右）
    <input type="range" id="posX" min="-1" max="1" step="0.01" value="0">
  </label>

  <label>Y（上下）
    <input type="range" id="posY" min="-1" max="1" step="0.01" value="-0.6">
  </label>

  <label>Z（前後）
    <input type="range" id="posZ" min="-1" max="1" step="0.01" value="0">
  </label>

  <label>回転Y
    <input type="range" id="rotY" min="0" max="360" value="180">
  </label>

  <label>大きさ
    <input type="range" id="scale" min="0.05" max="1" step="0.01" value="0.15">
  </label>
</div>

<!-- ===== 制御スクリプト（これ1つだけ） ===== -->
<script>
  const image = document.querySelector('#image');
  const model = document.querySelector('#model');

  function showImage() {
    image.setAttribute('visible', true);
    model.setAttribute('visible', false);
  }

  function showModel() {
    image.setAttribute('visible', false);
    model.setAttribute('visible', true);
  }

  const posX = document.querySelector('#posX');
  const posY = document.querySelector('#posY');
  const posZ = document.querySelector('#posZ');
  const rotY = document.querySelector('#rotY');
  const scale = document.querySelector('#scale');

  /* 回転Yを一元管理 */
  let currentRotY = Number(rotY.value);

  function updateModel() {
    model.setAttribute(
      'position',
      `${posX.value} ${posY.value} ${posZ.value}`
    );

    model.setAttribute(
      'rotation',
      `-95 ${currentRotY} 0`
    );

    model.setAttribute(
      'scale',
      `${scale.value} ${scale.value} ${scale.value}`
    );
  }

  /* スライダー操作 */
  posX.oninput = updateModel;
  posY.oninput = updateModel;
  posZ.oninput = updateModel;
  scale.oninput = updateModel;

  rotY.oninput = () => {
    currentRotY = Number(rotY.value);
    updateModel();
  };

  /* 3Dモデルをタップで回転 */
  model.addEventListener('click', () => {
    currentRotY += 45;
    rotY.value = currentRotY;
    updateModel();
  });
</script>
  let isDragging = false;
  let lastX = 0;

  // 画面を押したとき
  window.addEventListener('mousedown', (e) => {
    if (!model.getAttribute('visible')) return;
    isDragging = true;
    lastX = e.clientX;
  });

  // 指（マウス）を動かしたとき
  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;

    const deltaX = e.clientX - lastX;
    lastX = e.clientX;

    // 回転Yに加算（感度は 0.5 くらいがちょうどいい）
    currentRotY += deltaX * 0.5;
    rotY.value = currentRotY;
    updateModel();
  });

  // 離したとき
  window.addEventListener('mouseup', () => {
    isDragging = false;
  });

  // スマホ対応（タッチ）
  window.addEventListener('touchstart', (e) => {
    if (!model.getAttribute('visible')) return;
    isDragging = true;
    lastX = e.touches[0].clientX;
  });

  window.addEventListener('touchmove', (e) => {
    if (!isDragging) return;

    const deltaX = e.touches[0].clientX - lastX;
    lastX = e.touches[0].clientX;

    currentRotY += deltaX * 0.5;
    rotY.value = currentRotY;
    updateModel();
  });

  window.addEventListener('touchend', () => {
    isDragging = false;
  });
</script>

</body>
</html>














































