<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>AR Image Switch</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
}

#nextBtn2D {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 15px 20px;
  font-size: 16px;
  background: blue;
  color: white;
  border: none;
  border-radius: 10px;
  z-index: 9999;
}

#prevBtn2D {
  position: fixed;
  bottom: 20px;
  left: 20px;
  padding: 15px 20px;
  font-size: 16px;
  background: gray;
  color: white;
  border: none;
  border-radius: 10px;
  z-index: 9999;
}
</style>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false"
>

  <a-assets id="assets"></a-assets>

  <a-marker
    id="marker"
    type="pattern"
    url="assets/markers/pattern-AKA2.patt"
  ></a-marker>

  <a-entity camera></a-entity>

</a-scene>

<button id="prevBtn2D">◀ 前へ</button>
<button id="nextBtn2D">次へ ▶</button>

<script>
let isMarkerVisible = false;

const marker = document.getElementById("marker");
const assets = document.getElementById("assets");

/* ===== 保存データ読み込み ===== */

const savedImages =
  JSON.parse(localStorage.getItem("arImages")) || [
    "assets/images/sasanooaikon.png",
    "assets/images/tukareta.jpg",
    "assets/images/3.png"
  ];

let currentIndex =
  parseInt(localStorage.getItem("centerIndex")) || 1;

const imageElements = [];

/* ===== 画像生成 ===== */

savedImages.forEach((src, index) => {
  const assetImg = document.createElement("img");
  assetImg.setAttribute("id", "img-src-" + index);
  assetImg.setAttribute("src", src);
  assets.appendChild(assetImg);

  const aImg = document.createElement("a-image");
  aImg.setAttribute("src", "#img-src-" + index);
  aImg.setAttribute("rotation", "-90 0 0");
  marker.appendChild(aImg);

  imageElements.push(aImg);
});

/* ===== 配置更新 ===== */

function updateImages() {
  imageElements.forEach((el, index) => {
    let pos, scale;

    if (index === currentIndex) {
      pos = "0 0 0";
      scale = "1.2 1.2 1.2";
    } else if (index < currentIndex) {
      pos = "-1 0 0";
      scale = "0.6 0.6 0.6";
    } else {
      pos = "1 0 0";
      scale = "0.6 0.6 0.6";
    }

    el.setAttribute("position", pos);
    el.setAttribute("scale", scale);
  });
}

/* ===== マーカー判定 ===== */

marker.addEventListener("markerFound", () => {
  isMarkerVisible = true;
});

marker.addEventListener("markerLost", () => {
  isMarkerVisible = false;
});

/* ===== ボタン操作 ===== */

document.getElementById("nextBtn2D")
  .addEventListener("click", () => {
    if (!isMarkerVisible) return;

    currentIndex =
      (currentIndex + 1) % imageElements.length;

    updateImages();
  });

document.getElementById("prevBtn2D")
  .addEventListener("click", () => {
    if (!isMarkerVisible) return;

    currentIndex =
      (currentIndex - 1 + imageElements.length) %
      imageElements.length;

    updateImages();
  });

window.addEventListener("load", updateImages);
</script>

</body>
</html>
