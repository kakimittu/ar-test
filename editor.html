<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>AR Multi-Editor Pro</title>
<style>
  body { font-family: 'Consolas', monospace; background: #000a14; color: #00f2ff; text-align: center; margin: 0; padding: 20px; }
  
  /* プレビューエリアを3D空間っぽく */
  #previewArea { 
    position: relative; height: 350px; border: 2px solid #00f2ff; 
    background: radial-gradient(circle at center, #001a33 0%, #000a14 100%);
    perspective: 1000px; display: flex; justify-content: center; align-items: center;
    overflow: hidden;
  }

  /* 地面（グリッド）を表示して上下移動を分かりやすくする */
  .grid-floor {
    position: absolute; bottom: 50px; width: 200%; height: 200px;
    background-image: linear-gradient(#00f2ff33 1px, transparent 1px), linear-gradient(90deg, #00f2ff33 1px, transparent 1px);
    background-size: 40px 40px; transform: rotateX(80deg); z-index: 0;
  }

  /* 画像コンテナ */
  #imgGroup { display: flex; gap: 20px; transition: 0.1s; position: relative; z-index: 1; }
  .previewImg { width: 100px; border: 2px solid #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
  .active { border-color: #00f2ff; box-shadow: 0 0 20px #00f2ff; }

  .control-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: rgba(0,20,40,0.9); padding: 20px; }
  input[type="range"] { width: 100%; }
  label { font-size: 11px; display: block; margin-top: 10px; color: #aaa; }
</style>
</head>
<body>

<h3>AR ASSET CONFIGURATOR</h3>

<input type="text" id="markerName" placeholder="マーカー名(mainなど)" value="main">
<input type="file" id="fileInput" accept="image/*" multiple>

<div id="previewArea">
  <div class="grid-floor"></div>
  <div id="imgGroup">
    </div>
</div>

<div class="control-panel">
  <div>
    <label>HEIGHT (上下移動)</label>
    <input type="range" id="posY" min="-2" max="5" step="0.1" value="0.5">
    <label>SCALE (大きさ)</label>
    <input type="range" id="scale" min="0.1" max="5" step="0.1" value="1.0">
  </div>
  <div>
    <label>TILT (前後の倒れ)</label>
    <input type="range" id="rotX" min="-180" max="0" step="1" value="-90">
    <label>GAP (画像間の距離)</label>
    <input type="range" id="gap" min="10" max="200" step="1" value="20">
  </div>
</div>

<button id="saveBtn" style="width:100%; padding:15px; background:#00f2ff; font-weight:bold; margin-top:10px;">SAVE TO FIRESTORE</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = { apiKey: "あなたのキー", projectId: "armisetai", /* ... */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let imagesBase64 = [];
const imgGroup = document.getElementById("imgGroup");
const sliders = ['posY', 'scale', 'rotX', 'gap'].reduce((acc, id) => {
  acc[id] = document.getElementById(id);
  acc[id].oninput = updatePreview;
  return acc;
}, {});

function updatePreview() {
  // 3枚の画像グループ全体を動かす
  const y = sliders.posY.value * 50; // 視覚的に分かりやすく倍率調整
  const s = sliders.scale.value;
  const rx = sliders.rotX.value;
  const g = sliders.gap.value;

  imgGroup.style.transform = `translateY(${-y}px) scale(${s}) rotateX(${rx + 90}deg)`;
  imgGroup.style.gap = `${g}px`;
}

fileInput.onchange = async (e) => {
  const files = Array.from(e.target.files).slice(0, 3);
  imagesBase64 = [];
  imgGroup.innerHTML = "";
  
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      imagesBase64.push(ev.target.result);
      const img = document.createElement("img");
      img.src = ev.target.result;
      img.className = "previewImg";
      imgGroup.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
};

document.getElementById("saveBtn").onclick = async () => {
  const name = document.getElementById("markerName").value;
  await setDoc(doc(db, "arData", name), {
    images: imagesBase64,
    transform: {
      position: `0 ${sliders.posY.value} 0`,
      rotation: `${sliders.rotX.value} 0 0`,
      scale: `${sliders.scale.value} ${sliders.scale.value} ${sliders.scale.value}`,
      gap: sliders.gap.value / 100 // index側で使用
    }
  });
  alert("保存完了！");
};
</script>
</body>
</html>
